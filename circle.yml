checkout:
  post:
    - chmod 755 ./gradlew
    - chmod -R 755 ./script
machine:
  timezone:
    Asia/Tokyo
  java:
    version: oraclejdk8
  environment:
    ANDROID_HOME: /home/ubuntu/android-sdk
    ANDROID_NDK_HOME: /home/ubuntu/android-ndk
    GRADLE_OPTS: -Xmx2G -Dorg.gradle.daemon=true
    JAVA_OPTS: -Dfile.encoding=UTF-8 -Xms1024m -Xmx2048m -XX:MaxPermSize=2048m
dependencies:
  cache_directories:
    - "/home/ubuntu/android-sdk"
  override:
    - sh -c "$(curl -fsSL https://raw.githubusercontent.com/eaglesakura/build-dependencies/master/circleci/install-android-sdk-auto.sh)"
test:
  override:
    - |
      ./script/prebuilt-linux.sh
      export LD_LIBRARY_PATH=`pwd`:$LD_LIBRARY_PATH
      sh -c "$(curl -fsSL https://raw.githubusercontent.com/eaglesakura/build-dependencies/master/circleci/build-test.sh)"
deployment:
  release:
    tag: /^v[0-9]\..*$/
    commands:
      - ./gradlew bintrayUpload
  feature:
    branch: /^feature\/id\/.*$/
    commands:
      - ./gradlew bintrayUpload
  snapshot:
    branch: /^v[0-9]\..*$/
    commands:
      - ./gradlew bintrayUpload
  develop:
    branch: develop
    commands:
      - echo "skip upload"
